---
import Layout from "../../layouts/Layout.astro";
import SectionComponent2 from "../../components/project/Section.vue";

export async function getStaticPaths() {
  const response = await fetch('https://estate-strapi.srv01.dtsmart.dev/api/projects?populate=*');
  const obj = await response.json();
  const projects = await obj.data;
  let arr = []
  projects.forEach((e:any, i:number) => {
    let item =  {
      params: {id: e.id + '' }
    }
    arr.push(item)
  })
  return arr 
}

const { id } = Astro.params;
const response = await fetch('https://estate-strapi.srv01.dtsmart.dev/api/projects/' + id + '?populate=*');
const response2 = await fetch('https://estate-strapi.srv01.dtsmart.dev/api/projects/' + id + '?populate=*,section.thumnail');
const json = await response.json();
const json2 = await response2.json();



const project = json.data.attributes
const sections = json2.data.attributes.section

// const { frontmatter } = Astro.props;

const baseUrl = "https://estate-strapi.srv01.dtsmart.dev"

---

<Layout title="Landscaping Company">
    <main>
        <div class="project-page" style={"--title-background: url('" + baseUrl  + project.image_banner.data.attributes.url + "')"}>
            <div class="flex-center title">
                <p class="text-[68px] text-white font-extrabold">
                    { project.name_project }
                </p>
            </div>
            {sections.map((item) => (
                <>
                <section class="project-section">
                    <div class="container">
                        <div class="pt-[120px] flex flex-col items-center section-title">
                            <p class="text-[30px] font-extrabold text-primary-hover text-center ">{item.title}</p>
                        </div>
                        <div class="w-full flex-center">
                            <div class="class text-center text-primary-hover mb-6 w-[80%]" set:html={item.text}></div>
                        </div>
                        <div class="flex justify-betwwen project-detail">
                            <div class="w-1/2 pr-6 mb-4 project-detail-item" set:html={item.description}></div>
                            {item.thumnail.data != null 
                                ?
                                <img class="w-1/2 project-detail-item" class="w-full" src={baseUrl + item.thumnail.data.attributes.url} alt="" />
                                :
                                <span></span>
                            }
                        </div>
                    </div>
                </section>
                </>
            ))}
            <!-- <SectionComponent2  item={frontmatter} type={1}/>
            <SectionComponent2  item={frontmatter} type={2}/>
            <SectionComponent2  item={frontmatter} type={3}/> -->
            <!-- <SectionComponent2  item={frontmatter} type={3}/> -->


        </div>

    </main>

</Layout>

<script define:vars={{project}}>
    // console.log(project,'aaaaaaaaaaaa');
</script>

<style lang="scss">
    .project-page{
        .title{
            width: 100%;
            height: 550px;
            background-image: var(--title-background);
            background-size: cover;
            position: relative;
            p{
                z-index: 10;
            }
            &::before{
                position: absolute;
                content: '';
                background: #000;
                width: 100%;
                height: 100%;
                left: 0px;
                top: 0px;
                opacity: 0.7;
                z-index: 1;
            }
        }
        .detail{
            button{
                margin-top: 50px;
                a{
                    padding: 15.5px 32px;
                    border-radius: 2px;
                    background-color: var(--primary-hover);
                    color: #fff;
                    font-weight: 600;
                }
            }
        }
        @media (max-width: 767px) {
            .detail{
                .detail-box{
                    flex-wrap: wrap;
                    .left, .right{
                        width: 90%;
                    }
                    .left{
                        margin-bottom: 20px;
                    }
                }
            }
        }
        .project-section{
            .section-title{
                position: relative;
                margin-bottom: 100px;
                p::after{
                    content: "";
                    width: 60px;
                    height: 3px;
                    background-color: var(--primary-hover);
                    position: absolute;
                    bottom: 0;
                    left: 50%;
                    transform: translateX(-50%);
                    margin-bottom: -8px;
                }
                .project-detail{

                }
            }
            @media (max-width: 767px) {
                .project-detail{
                    flex-direction: column;
                    .project-detail-item{
                        width: 100%;
                    }
                }

            }
            &:last-child{
                padding-bottom: 100px;
            }

        }
    }
</style>